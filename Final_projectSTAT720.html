<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jean(naien) Li">

<title>STAT720 Project_Life Expectancy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Final_projectSTAT720_files/libs/clipboard/clipboard.min.js"></script>
<script src="Final_projectSTAT720_files/libs/quarto-html/quarto.js"></script>
<script src="Final_projectSTAT720_files/libs/quarto-html/popper.min.js"></script>
<script src="Final_projectSTAT720_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Final_projectSTAT720_files/libs/quarto-html/anchor.min.js"></script>
<link href="Final_projectSTAT720_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Final_projectSTAT720_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Final_projectSTAT720_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Final_projectSTAT720_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Final_projectSTAT720_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">STAT720 Project_Life Expectancy</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jean(naien) Li </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datawizard)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coefplot)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaps)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MCMCglmm)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GLMMadaptive)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"DHARMa"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<section id="dataset" class="level3">
<h3 class="anchored" data-anchor-id="dataset">Dataset</h3>
<p>The dataset used in this project was sourced from the Kaggle website and focuses on life expectancy. It includes health factors for 193 countries, with data collected from the World Health Organization (WHO) repository, alongside corresponding economic information from the United Nations website. The analysis covers the years 2000 to 2015. The individual data files were merged into a single dataset. Countries with missing values were excluded from the final model, primarily because the missing data came from lesser-known countries such as Vanuatu, Tonga, Togo, and Cabo Verde, making it challenging to obtain complete information for these nations. However, some columns still contain missing values.</p>
<p>Consequently, the final merged file (final dataset) contains 22 columns and 2,938 rows. All predicting variables were then categorized into several broad groups: immunization-related factors, mortality factors, economic factors, and social factors.</p>
</section>
<section id="original-question" class="level3">
<h3 class="anchored" data-anchor-id="original-question">Original question</h3>
<ol type="1">
<li><p>Increase the variety of area influence factors and predictors. Explore the significant predictors that affect life expectancy, both positively and negatively. Historically, many studies have focused primarily on demographic variables, income composition, and mortality rates. There has been a growing emphasis on the impact of immunization along with various social and economic factors.</p></li>
<li><p>Select a more complex model with year and country variables rather than relying solely on multiple linear regression. This approach will help address the factors mentioned earlier by formulating a regression model based on mixed effects and multiple linear regression techniques. The analysis will consider data from 2000 to 2015 across all countries. However, I need help finding the methods used on the website.</p></li>
</ol>
</section>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<section id="predictor-response-rv" class="level3">
<h3 class="anchored" data-anchor-id="predictor-response-rv">Predictor &amp; Response rv</h3>
<p>We will use life expectancy as the response variable, employing a Gaussian conditional distribution. Since there are many predictors, we will first apply an ordinary linear regression model to assess the linearity of the relationships. We will then consider the addition of splines and select the most relevant predictors through diagnostic plots and best subset feature selection. For the predictors chosen after feature selection, we will ensure that they are reasonable. Additionally, we will account for random effects grouped by country, which has been identified as a significant variable. #### data exploratory analysis</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"Life Expectancy Data.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">data</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">2938</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">22</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Country</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">193</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Status</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 23%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Year</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2007.52</td>
<td style="text-align: right;">4.61</td>
<td style="text-align: right;">2000.00</td>
<td style="text-align: right;">2004.00</td>
<td style="text-align: right;">2008.00</td>
<td style="text-align: right;">2012.00</td>
<td style="text-align: right;">2.015000e+03</td>
<td style="text-align: left;">▇▆▆▆▆</td>
</tr>
<tr class="even">
<td style="text-align: left;">Life.expectancy</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">69.22</td>
<td style="text-align: right;">9.52</td>
<td style="text-align: right;">36.30</td>
<td style="text-align: right;">63.10</td>
<td style="text-align: right;">72.10</td>
<td style="text-align: right;">75.70</td>
<td style="text-align: right;">8.900000e+01</td>
<td style="text-align: left;">▁▂▃▇▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adult.Mortality</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">164.80</td>
<td style="text-align: right;">124.29</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">74.00</td>
<td style="text-align: right;">144.00</td>
<td style="text-align: right;">228.00</td>
<td style="text-align: right;">7.230000e+02</td>
<td style="text-align: left;">▇▆▂▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">infant.deaths</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">30.30</td>
<td style="text-align: right;">117.93</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">22.00</td>
<td style="text-align: right;">1.800000e+03</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alcohol</td>
<td style="text-align: right;">194</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">4.60</td>
<td style="text-align: right;">4.05</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: right;">3.76</td>
<td style="text-align: right;">7.70</td>
<td style="text-align: right;">1.787000e+01</td>
<td style="text-align: left;">▇▃▃▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">percentage.expenditure</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">738.25</td>
<td style="text-align: right;">1987.91</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">4.69</td>
<td style="text-align: right;">64.91</td>
<td style="text-align: right;">441.53</td>
<td style="text-align: right;">1.947991e+04</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hepatitis.B</td>
<td style="text-align: right;">553</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">80.94</td>
<td style="text-align: right;">25.07</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">77.00</td>
<td style="text-align: right;">92.00</td>
<td style="text-align: right;">97.00</td>
<td style="text-align: right;">9.900000e+01</td>
<td style="text-align: left;">▁▁▁▂▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">Measles</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2419.59</td>
<td style="text-align: right;">11467.27</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">17.00</td>
<td style="text-align: right;">360.25</td>
<td style="text-align: right;">2.121830e+05</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BMI</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">38.32</td>
<td style="text-align: right;">20.04</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">19.30</td>
<td style="text-align: right;">43.50</td>
<td style="text-align: right;">56.20</td>
<td style="text-align: right;">8.730000e+01</td>
<td style="text-align: left;">▅▅▅▇▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">under.five.deaths</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">42.04</td>
<td style="text-align: right;">160.45</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">28.00</td>
<td style="text-align: right;">2.500000e+03</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Polio</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">82.55</td>
<td style="text-align: right;">23.43</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">78.00</td>
<td style="text-align: right;">93.00</td>
<td style="text-align: right;">97.00</td>
<td style="text-align: right;">9.900000e+01</td>
<td style="text-align: left;">▁▁▁▂▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">Total.expenditure</td>
<td style="text-align: right;">226</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">5.94</td>
<td style="text-align: right;">2.50</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">4.26</td>
<td style="text-align: right;">5.76</td>
<td style="text-align: right;">7.49</td>
<td style="text-align: right;">1.760000e+01</td>
<td style="text-align: left;">▃▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Diphtheria</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">82.32</td>
<td style="text-align: right;">23.72</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">78.00</td>
<td style="text-align: right;">93.00</td>
<td style="text-align: right;">97.00</td>
<td style="text-align: right;">9.900000e+01</td>
<td style="text-align: left;">▁▁▁▂▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">HIV.AIDS</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.74</td>
<td style="text-align: right;">5.08</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">5.060000e+01</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GDP</td>
<td style="text-align: right;">448</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">7483.16</td>
<td style="text-align: right;">14270.17</td>
<td style="text-align: right;">1.68</td>
<td style="text-align: right;">463.94</td>
<td style="text-align: right;">1766.95</td>
<td style="text-align: right;">5910.81</td>
<td style="text-align: right;">1.191727e+05</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">Population</td>
<td style="text-align: right;">652</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">12753375.12</td>
<td style="text-align: right;">61012096.51</td>
<td style="text-align: right;">34.00</td>
<td style="text-align: right;">195793.25</td>
<td style="text-align: right;">1386542.00</td>
<td style="text-align: right;">7420359.00</td>
<td style="text-align: right;">1.293859e+09</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">thinness..1.19.years</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">4.84</td>
<td style="text-align: right;">4.42</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">1.60</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">7.20</td>
<td style="text-align: right;">2.770000e+01</td>
<td style="text-align: left;">▇▃▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">thinness.5.9.years</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">4.87</td>
<td style="text-align: right;">4.51</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">7.20</td>
<td style="text-align: right;">2.860000e+01</td>
<td style="text-align: left;">▇▃▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Income.composition.of.resources</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.68</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">9.500000e-01</td>
<td style="text-align: left;">▁▁▅▇▆</td>
</tr>
<tr class="even">
<td style="text-align: left;">Schooling</td>
<td style="text-align: right;">163</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">11.99</td>
<td style="text-align: right;">3.36</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">10.10</td>
<td style="text-align: right;">12.30</td>
<td style="text-align: right;">14.30</td>
<td style="text-align: right;">2.070000e+01</td>
<td style="text-align: left;">▁▂▇▇▁</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the caregorical variables to factor, and re-arrange the column. </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Country<span class="ot">&lt;-</span><span class="fu">as.factor</span>(data<span class="sc">$</span>Country)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Status<span class="ot">&lt;-</span><span class="fu">as.factor</span>(data<span class="sc">$</span>Status)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">colnames</span>(data)[<span class="sc">-</span><span class="dv">4</span>],Life.expectancy)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># detect missing value and mutate the missing value by the mean of the column grouped by country(initially using mutate, but it doesn't work.)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>missing_names<span class="ot">&lt;-</span><span class="fu">names</span>(<span class="fu">which</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(data))<span class="sc">&gt;</span><span class="dv">0</span>))</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(missing_names)) {</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  col_names<span class="ot">&lt;-</span>missing_names[j]</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data)) {</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(data[,col_names][i])){</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      country<span class="ot">&lt;-</span>data<span class="sc">$</span>Country[i]</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>      data[,col_names][i]<span class="ot">&lt;-</span><span class="fu">tapply</span>(data[,col_names],data<span class="sc">$</span>Country<span class="sc">==</span>country,mean,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the continous predictors</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">4</span><span class="sc">:</span><span class="fu">ncol</span>(data)<span class="sc">-</span><span class="dv">1</span>) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">class</span>(data[,i])<span class="sc">==</span><span class="st">"integer"</span><span class="sc">|</span><span class="fu">class</span>(data[,i])<span class="sc">==</span><span class="st">"numeric"</span>){</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    col_name<span class="ot">&lt;-</span><span class="fu">colnames</span>(data)[i]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  datawizard<span class="sc">::</span><span class="fu">standardize</span>(data,<span class="at">select =</span> col_name)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>}}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="linearity-best-subset-feature-selection" class="level4">
<h4 class="anchored" data-anchor-id="linearity-best-subset-feature-selection">linearity &amp; best subset feature selection</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ordinary linear model, testing the linearity and conditional distribution of response varaible</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>data_nocountry<span class="ot">&lt;-</span>data<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Country)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>model1<span class="ot">&lt;-</span><span class="fu">lm</span>(Life.expectancy<span class="sc">~</span>.,<span class="at">data=</span>data_nocountry)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">summary</span>(model1)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_collinearity</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for Multicollinearity

Low Correlation

                            Term  VIF       VIF 95% CI Increased SE Tolerance
                            Year 1.15 [  1.11,   1.20]         1.07      0.87
                          Status 1.88 [  1.79,   1.98]         1.37      0.53
                 Adult.Mortality 1.75 [  1.66,   1.84]         1.32      0.57
                         Alcohol 1.86 [  1.77,   1.97]         1.36      0.54
                     Hepatitis.B 1.40 [  1.34,   1.47]         1.18      0.71
                         Measles 1.38 [  1.32,   1.45]         1.18      0.72
                             BMI 1.73 [  1.64,   1.82]         1.31      0.58
                           Polio 1.95 [  1.85,   2.06]         1.40      0.51
               Total.expenditure 1.21 [  1.16,   1.27]         1.10      0.83
                      Diphtheria 2.22 [  2.10,   2.35]         1.49      0.45
                        HIV.AIDS 1.44 [  1.38,   1.51]         1.20      0.70
                      Population 1.49 [  1.42,   1.56]         1.22      0.67
 Income.composition.of.resources 3.09 [  2.91,   3.28]         1.76      0.32
                       Schooling 3.35 [  3.15,   3.56]         1.83      0.30
 Tolerance 95% CI
     [0.83, 0.90]
     [0.50, 0.56]
     [0.54, 0.60]
     [0.51, 0.56]
     [0.68, 0.75]
     [0.69, 0.76]
     [0.55, 0.61]
     [0.49, 0.54]
     [0.79, 0.86]
     [0.43, 0.48]
     [0.66, 0.73]
     [0.64, 0.70]
     [0.30, 0.34]
     [0.28, 0.32]

Moderate Correlation

                   Term  VIF       VIF 95% CI Increased SE Tolerance
 percentage.expenditure 5.07 [  4.76,   5.41]         2.25      0.20
                    GDP 5.23 [  4.91,   5.59]         2.29      0.19
   thinness..1.19.years 8.78 [  8.20,   9.39]         2.96      0.11
     thinness.5.9.years 8.87 [  8.29,   9.49]         2.98      0.11
 Tolerance 95% CI
     [0.18, 0.21]
     [0.18, 0.20]
     [0.11, 0.12]
     [0.11, 0.12]

High Correlation

              Term    VIF       VIF 95% CI Increased SE Tolerance
     infant.deaths 176.81 [164.61, 189.93]        13.30  5.66e-03
 under.five.deaths 175.82 [163.68, 188.86]        13.26  5.69e-03
 Tolerance 95% CI
     [0.01, 0.01]
     [0.01, 0.01]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>coefplot<span class="sc">::</span><span class="fu">coefplot</span>(model1,<span class="at">intercept=</span><span class="cn">FALSE</span>,<span class="at">title=</span><span class="st">"Coefficient Plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>best_subset <span class="ot">&lt;-</span> leaps<span class="sc">::</span><span class="fu">regsubsets</span>(Life.expectancy <span class="sc">~</span> ., <span class="at">data =</span> data_nocountry, <span class="at">nvmax =</span> <span class="dv">7</span>, <span class="at">really.big =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>summary_best<span class="ot">&lt;-</span><span class="fu">summary</span>(best_subset)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(summary_best<span class="sc">$</span>adjr2,<span class="at">xlab =</span> <span class="st">"Number of Predictors"</span>,<span class="at">ylab =</span> <span class="st">"Adjusted R^2"</span>,<span class="at">type =</span> <span class="st">"b"</span>,<span class="at">main =</span> <span class="st">"Adjusted R^2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.max</span>(summary_best<span class="sc">$</span>adjr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(best_subset,<span class="fu">which.max</span>(summary_best<span class="sc">$</span>adjr2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    (Intercept)                StatusDeveloping 
                    54.89621526                     -2.37285093 
                Adult.Mortality                             BMI 
                    -0.02057941                      0.05767388 
                     Diphtheria                        HIV.AIDS 
                     0.06024631                     -0.47626922 
Income.composition.of.resources                       Schooling 
                     6.94969532                      0.74861762 </code></pre>
</div>
</div>
<p>Using the diagnostic plots, we can assess whether the model shows linearity, that is, linearity and does not add splines and if the conditional distribution of the response variable follows a Gaussian distribution. Next, we will select the seven best predictors: Adult Mortality, BMI, Diphtheria, HIV/AIDS, Income Composition of Resources, Schooling, Status (Developing), and year. The random effect group variable will be the country.</p>
</section>
<section id="maximal-modelstrategies" class="level4">
<h4 class="anchored" data-anchor-id="maximal-modelstrategies">maximal model&amp;strategies</h4>
<ol type="1">
<li>And for the maximal model is the Life_expectancy~ adult_mortality+BMI+Diphtheria+HIV.AIDS+income_composition+schooling+status+year+(1+fixed predictors(8)|country)</li>
<li>I will choose the PQL(quick for the large datase); AGHQ or MCMCglmm to integrate over random effects.</li>
<li>If there are computational or singular fit problems, I will scale the continuous random variables (done), simplify the random effects structure, and use approximate methods like MCMCglmm.</li>
</ol>
</section>
<section id="selectrename-priors-chosen" class="level4">
<h4 class="anchored" data-anchor-id="selectrename-priors-chosen">select,rename &amp; priors chosen</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data_new<span class="ot">&lt;-</span>data<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(Country,Year,Status,Adult.Mortality,BMI,Diphtheria,HIV.AIDS,Income.composition.of.resources,Schooling,Life.expectancy))<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Adult=</span>Adult.Mortality,<span class="at">HIV=</span>HIV.AIDS,<span class="at">Income_composition=</span>Income.composition.of.resources)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># priors with fixed effects, random effects, residual variance </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(best_subset,<span class="fu">which.max</span>(summary_best<span class="sc">$</span>adjr2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    (Intercept)                StatusDeveloping 
                    54.89621526                     -2.37285093 
                Adult.Mortality                             BMI 
                    -0.02057941                      0.05767388 
                     Diphtheria                        HIV.AIDS 
                     0.06024631                     -0.47626922 
Income.composition.of.resources                       Schooling 
                     6.94969532                      0.74861762 </code></pre>
</div>
</div>
<p>Initially, we will set the prior distribution for the residual variance parameter as an inverse-Wishart, with a variance of 1 and degrees of freedom of 0.002 (default at the beginning).</p>
<p>The prior for the fixed effects will be multivariate normal, with a mean of 0, a variance of 5, and a total of 9 fixed effects, which are assumed to be independent.</p>
<p>The prior for the random effects will also be an inverse-Wishart, with a variance of 1 and degrees of freedom equal to 8, corresponding to the number of random effects.</p>
</section>
</section>
<section id="package" class="level3">
<h3 class="anchored" data-anchor-id="package">Package</h3>
<p>I will choose the lme4 package as the frequentist baseline for handling linear mixed models with efficiently large datasets. For a Bayesian approach, I will use the MCMCglmm package, which offers a wide range of prior distributions suitable for large datasets. Additionally, I will consider the nlme package.</p>
</section>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<section id="exploratory-plots" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-plots">exploratory plots</h3>
<ol type="1">
<li>The plot shows life expectancy concerning adult mortality, grouped by country.</li>
<li>The plot displays life expectancy concerning BMI, grouped by country.</li>
<li>The plot illustrates life expectancy concerning diphtheria rates, grouped by country.</li>
<li>The plot depicts life expectancy concerning HIV prevalence, grouped by country.</li>
<li>The plot examines life expectancy concerning income composition, grouped by country.</li>
<li>The plot represents life expectancy concerning schooling, grouped by country.</li>
<li>The plot highlights life expectancy based on health status, grouped by country.</li>
<li>The plot analyzes life expectancy by year, grouped by country.</li>
<li>The plot presents a histogram of life expectancy.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>data_new<span class="sc">|&gt;</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>Adult , <span class="at">y =</span>Life.expectancy, <span class="at">colour =</span>Country)) <span class="sc">+</span> ggalt<span class="sc">::</span><span class="fu">geom_encircle</span>() <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The Life Expectancy relation with the Adult Mortality and Country"</span>,<span class="at">x =</span> <span class="st">"Adult Mortality"</span>,<span class="at">y =</span> <span class="st">"Life Expectancy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 methods overwritten by 'ggalt':
  method                  from   
  grid.draw.absoluteGrob  ggplot2
  grobHeight.absoluteGrob ggplot2
  grobWidth.absoluteGrob  ggplot2
  grobX.absoluteGrob      ggplot2
  grobY.absoluteGrob      ggplot2</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>data_new<span class="sc">|&gt;</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>BMI, <span class="at">y =</span>Life.expectancy, <span class="at">colour =</span>Country)) <span class="sc">+</span> ggalt<span class="sc">::</span><span class="fu">geom_encircle</span>() <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The Life Expectancy relation with the BMI and Country"</span>,<span class="at">x =</span> <span class="st">"BMI"</span>,<span class="at">y =</span> <span class="st">"Life Expectancy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data_new<span class="sc">|&gt;</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>Diphtheria, <span class="at">y =</span>Life.expectancy, <span class="at">colour =</span>Country)) <span class="sc">+</span> ggalt<span class="sc">::</span><span class="fu">geom_encircle</span>() <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The Life Expectancy relation with the Diphtheria and Country"</span>,<span class="at">x =</span> <span class="st">"Diphtheria"</span>,<span class="at">y =</span> <span class="st">"Life Expectancy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>data_new<span class="sc">|&gt;</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>HIV, <span class="at">y =</span>Life.expectancy, <span class="at">colour =</span>Country)) <span class="sc">+</span> ggalt<span class="sc">::</span><span class="fu">geom_encircle</span>() <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The Life Expectancy relation with the HIV and Country"</span>,<span class="at">x =</span> <span class="st">"HIV"</span>,<span class="at">y =</span> <span class="st">"Life Expectancy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-5-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>data_new<span class="sc">|&gt;</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>Income_composition, <span class="at">y =</span>Life.expectancy, <span class="at">colour =</span>Country)) <span class="sc">+</span> ggalt<span class="sc">::</span><span class="fu">geom_encircle</span>() <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The Life Expectancy relation with the Income composition and Country"</span>,<span class="at">x =</span> <span class="st">"Income Composition"</span>,<span class="at">y =</span> <span class="st">"Life Expectancy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-5-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data_new<span class="sc">|&gt;</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>Schooling, <span class="at">y =</span>Life.expectancy, <span class="at">colour =</span>Country)) <span class="sc">+</span> ggalt<span class="sc">::</span><span class="fu">geom_encircle</span>() <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The Life Expectancy relation with the Schooling and Country"</span>,<span class="at">x =</span> <span class="st">"Schooling"</span>,<span class="at">y =</span> <span class="st">"Life Expectancy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-5-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data_new<span class="sc">|&gt;</span>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>Status, <span class="at">y =</span>Life.expectancy,<span class="at">colour =</span> Country)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The relation of Life Expectancy with two Status, by country"</span>,<span class="at">x=</span><span class="st">"Status"</span>,<span class="at">y=</span><span class="st">"Life Expectancy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-5-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data_new<span class="sc">|&gt;</span>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Life.expectancy, <span class="at">colour =</span> country)) <span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The relation of Life Expectancy with Year, by country"</span>,<span class="at">x =</span> <span class="st">"Year"</span>,<span class="at">y =</span> <span class="st">"Life Expectancy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-5-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>data_new<span class="sc">|&gt;</span>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(Life.expectancy))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Histogram of the life expectancy"</span>, <span class="at">x =</span> <span class="st">"Life expectancy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-5-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The first and third plots tell us the difference of the changes of Adult mortality and Diphtheria grouped by Country is very smaller, with overlap pattens with different country.</p>
</section>
<section id="fit-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-the-model">fit the model</h3>
<section id="lme4" class="level4">
<h4 class="anchored" data-anchor-id="lme4">lme4</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>model_lmemax<span class="ot">&lt;-</span>lme4<span class="sc">::</span><span class="fu">lmer</span>(Life.expectancy<span class="sc">~</span>Year<span class="sc">+</span>Status<span class="sc">+</span>Adult<span class="sc">+</span>BMI<span class="sc">+</span>Diphtheria<span class="sc">+</span>HIV<span class="sc">+</span>Income_composition<span class="sc">+</span>Schooling<span class="sc">+</span>(<span class="dv">1</span><span class="sc">+</span>Status<span class="sc">+</span>Adult<span class="sc">+</span>BMI<span class="sc">+</span>Diphtheria<span class="sc">+</span>HIV<span class="sc">+</span>Income_composition<span class="sc">+</span>Schooling<span class="sc">|</span>Country),<span class="at">data =</span> data_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optwrap(optimizer, devfun, getStart(start, rho$pp), lower =
rho$lower, : convergence code 5 from nloptwrap: NLOPT_MAXEVAL_REACHED:
Optimization stopped because maxeval (above) was reached.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_lmemax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: Life.expectancy ~ Year + Status + Adult + BMI + Diphtheria +  
    HIV + Income_composition + Schooling + (1 + Status + Adult +  
    BMI + Diphtheria + HIV + Income_composition + Schooling |      Country)
   Data: data_new

REML criterion at convergence: 12556.6

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-5.9942 -0.4003 -0.0852  0.1445  5.2028 

Random effects:
 Groups   Name               Variance  Std.Dev. Corr                         
 Country  (Intercept)        7.832e+01 8.84962                               
          StatusDeveloping   2.287e+01 4.78224   0.45                        
          Adult              3.600e-05 0.00600  -0.03 -0.11                  
          BMI                2.649e-04 0.01628   0.46 -0.04  0.73            
          Diphtheria         4.251e-05 0.00652  -0.17 -0.10 -0.40  0.04      
          HIV                2.571e-01 0.50704  -0.21  0.08  0.26 -0.36 -0.91
          Income_composition 3.712e+01 6.09266  -0.05 -0.39 -0.74 -0.34  0.62
          Schooling          4.546e-01 0.67420  -0.93 -0.20  0.24 -0.29  0.12
 Residual                    2.572e+00 1.60385                               
            
            
            
            
            
            
            
 -0.57      
  0.24 -0.27
            
Number of obs: 2938, groups:  Country, 193

Fixed effects:
                     Estimate Std. Error t value
(Intercept)        -3.164e+02  2.204e+01 -14.357
Year                1.923e-01  1.134e-02  16.960
StatusDeveloping   -7.423e+00  7.698e-01  -9.642
Adult              -1.662e-03  7.158e-04  -2.322
BMI                -2.306e-03  2.950e-03  -0.782
Diphtheria          5.640e-03  1.979e-03   2.850
HIV                -7.417e-01  9.486e-02  -7.818
Income_composition  4.152e+00  1.103e+00   3.766
Schooling           3.476e-01  8.552e-02   4.065

Correlation of Fixed Effects:
            (Intr) Year   SttsDv Adult  BMI    Dphthr HIV    Incm_c
Year        -0.999                                                 
StatsDvlpng  0.266 -0.288                                          
Adult       -0.054  0.051 -0.092                                   
BMI          0.088 -0.084 -0.004  0.154                            
Diphtheria   0.058 -0.065  0.033 -0.069  0.009                     
HIV         -0.132  0.127 -0.116  0.067 -0.009 -0.116              
Incm_cmpstn  0.217 -0.230  0.103 -0.217 -0.061  0.065 -0.083       
Schooling    0.342 -0.373  0.125  0.124 -0.070 -0.010  0.103 -0.350
optimizer (nloptwrap) convergence code: 5 (NLOPT_MAXEVAL_REACHED: Optimization stopped because maxeval (above) was reached.)
boundary (singular) fit: see help('isSingular')</code></pre>
</div>
</div>
</section>
<section id="mcmcglmm-better-to-adjust-the-computationalstatistical-problem" class="level4">
<h4 class="anchored" data-anchor-id="mcmcglmm-better-to-adjust-the-computationalstatistical-problem">MCMCglmm (better to adjust the computational/statistical problem)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="fu">list</span>(<span class="at">V=</span><span class="dv">1</span>, <span class="at">nu=</span><span class="fl">0.002</span>),        </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="fu">list</span>(<span class="at">G1=</span><span class="fu">list</span>(<span class="at">V=</span><span class="fu">diag</span>(<span class="dv">8</span>),<span class="at">nu=</span><span class="dv">8</span>)), </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">9</span>), <span class="at">V =</span> <span class="fu">diag</span>(<span class="dv">9</span>) <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>model_mcmcmax<span class="ot">&lt;-</span>MCMCglmm<span class="sc">::</span><span class="fu">MCMCglmm</span>(Life.expectancy<span class="sc">~</span>Adult<span class="sc">+</span>BMI<span class="sc">+</span>Diphtheria<span class="sc">+</span>HIV<span class="sc">+</span> Income_composition<span class="sc">+</span>Schooling<span class="sc">+</span>Status<span class="sc">+</span> Year,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="at">random=</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span><span class="sc">+</span>Status<span class="sc">+</span>Adult<span class="sc">+</span>BMI<span class="sc">+</span> Diphtheria<span class="sc">+</span>HIV<span class="sc">+</span>Income_composition<span class="sc">+</span>Schooling)<span class="sc">:</span>Country,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span> data_new,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">family=</span> <span class="st">"gaussian"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior=</span> priors,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">nitt =</span> <span class="dv">13000</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">burnin =</span> <span class="dv">3000</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">10</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                       MCMC iteration = 0

                       MCMC iteration = 1000

                       MCMC iteration = 2000

                       MCMC iteration = 3000

                       MCMC iteration = 4000

                       MCMC iteration = 5000

                       MCMC iteration = 6000

                       MCMC iteration = 7000

                       MCMC iteration = 8000

                       MCMC iteration = 9000

                       MCMC iteration = 10000

                       MCMC iteration = 11000

                       MCMC iteration = 12000

                       MCMC iteration = 13000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_mcmcmax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Iterations = 3001:12991
 Thinning interval  = 10
 Sample size  = 1000 

 DIC: 11948.49 

 G-structure:  ~us(1 + Status + Adult + BMI + Diphtheria + HIV + Income_composition + Schooling):Country

                                               post.mean   l-95% CI   u-95% CI
(Intercept):(Intercept).Country                1.287e+02  42.503840 254.930306
StatusDeveloping:(Intercept).Country           7.286e+00 -47.041808  40.629146
Adult:(Intercept).Country                     -2.417e-02  -0.314043   0.341654
BMI:(Intercept).Country                       -5.895e-02  -0.481577   0.340643
Diphtheria:(Intercept).Country                -5.978e-02  -0.486179   0.336634
HIV:(Intercept).Country                       -4.562e+00 -10.450443   0.469688
Income_composition:(Intercept).Country        -5.614e-03 -18.389024  17.916443
Schooling:(Intercept).Country                 -8.660e+00 -14.334516  -3.534630
(Intercept):StatusDeveloping.Country           7.286e+00 -47.041808  40.629146
StatusDeveloping:StatusDeveloping.Country      6.784e+00   0.518258  17.222430
Adult:StatusDeveloping.Country                -3.436e-03  -0.084381   0.077194
BMI:StatusDeveloping.Country                  -5.466e-03  -0.111505   0.105663
Diphtheria:StatusDeveloping.Country           -3.331e-03  -0.102709   0.091538
HIV:StatusDeveloping.Country                  -4.413e-01  -2.312642   1.959931
Income_composition:StatusDeveloping.Country   -2.005e-01  -4.528021   3.571598
Schooling:StatusDeveloping.Country            -7.952e-01  -3.249781   3.093199
(Intercept):Adult.Country                     -2.417e-02  -0.314043   0.341654
StatusDeveloping:Adult.Country                -3.436e-03  -0.084381   0.077194
Adult:Adult.Country                            4.328e-02   0.035158   0.052480
BMI:Adult.Country                             -5.242e-04  -0.007468   0.006295
Diphtheria:Adult.Country                      -1.364e-03  -0.008012   0.005417
HIV:Adult.Country                              1.296e-03  -0.029510   0.032953
Income_composition:Adult.Country              -1.117e-03  -0.043802   0.040383
Schooling:Adult.Country                       -2.246e-03  -0.033205   0.025914
(Intercept):BMI.Country                       -5.895e-02  -0.481577   0.340643
StatusDeveloping:BMI.Country                  -5.466e-03  -0.111505   0.105663
Adult:BMI.Country                             -5.242e-04  -0.007468   0.006295
BMI:BMI.Country                                5.379e-02   0.043169   0.066192
Diphtheria:BMI.Country                        -8.847e-04  -0.009321   0.006270
HIV:BMI.Country                                5.434e-04  -0.035596   0.040889
Income_composition:BMI.Country                 4.559e-04  -0.056150   0.060828
Schooling:BMI.Country                         -8.795e-03  -0.045876   0.028555
(Intercept):Diphtheria.Country                -5.978e-02  -0.486179   0.336634
StatusDeveloping:Diphtheria.Country           -3.331e-03  -0.102709   0.091538
Adult:Diphtheria.Country                      -1.364e-03  -0.008012   0.005417
BMI:Diphtheria.Country                        -8.847e-04  -0.009321   0.006270
Diphtheria:Diphtheria.Country                  5.054e-02   0.039997   0.060967
HIV:Diphtheria.Country                         5.439e-03  -0.036985   0.041853
Income_composition:Diphtheria.Country         -5.074e-03  -0.063740   0.047758
Schooling:Diphtheria.Country                  -2.339e-02  -0.055685   0.014142
(Intercept):HIV.Country                       -4.562e+00 -10.450443   0.469688
StatusDeveloping:HIV.Country                  -4.413e-01  -2.312642   1.959931
Adult:HIV.Country                              1.296e-03  -0.029510   0.032953
BMI:HIV.Country                                5.434e-04  -0.035596   0.040889
Diphtheria:HIV.Country                         5.439e-03  -0.036985   0.041853
HIV:HIV.Country                                1.006e+00   0.487127   1.627276
Income_composition:HIV.Country                -1.089e-01  -1.198101   0.758230
Schooling:HIV.Country                          2.380e-01  -0.225309   0.624517
(Intercept):Income_composition.Country        -5.614e-03 -18.389024  17.916443
StatusDeveloping:Income_composition.Country   -2.005e-01  -4.528021   3.571598
Adult:Income_composition.Country              -1.117e-03  -0.043802   0.040383
BMI:Income_composition.Country                 4.559e-04  -0.056150   0.060828
Diphtheria:Income_composition.Country         -5.074e-03  -0.063740   0.047758
HIV:Income_composition.Country                -1.089e-01  -1.198101   0.758230
Income_composition:Income_composition.Country  2.187e+00   0.471259   5.096662
Schooling:Income_composition.Country          -3.545e-02  -1.371341   1.272152
(Intercept):Schooling.Country                 -8.660e+00 -14.334516  -3.534630
StatusDeveloping:Schooling.Country            -7.952e-01  -3.249781   3.093199
Adult:Schooling.Country                       -2.246e-03  -0.033205   0.025914
BMI:Schooling.Country                         -8.795e-03  -0.045876   0.028555
Diphtheria:Schooling.Country                  -2.339e-02  -0.055685   0.014142
HIV:Schooling.Country                          2.380e-01  -0.225309   0.624517
Income_composition:Schooling.Country          -3.545e-02  -1.371341   1.272152
Schooling:Schooling.Country                    1.022e+00   0.661362   1.465115
                                              eff.samp
(Intercept):(Intercept).Country                 10.529
StatusDeveloping:(Intercept).Country             7.548
Adult:(Intercept).Country                      974.507
BMI:(Intercept).Country                        852.818
Diphtheria:(Intercept).Country                 660.437
HIV:(Intercept).Country                        280.052
Income_composition:(Intercept).Country          54.480
Schooling:(Intercept).Country                   38.710
(Intercept):StatusDeveloping.Country             7.548
StatusDeveloping:StatusDeveloping.Country       33.204
Adult:StatusDeveloping.Country                 962.323
BMI:StatusDeveloping.Country                   455.251
Diphtheria:StatusDeveloping.Country            487.053
HIV:StatusDeveloping.Country                    17.772
Income_composition:StatusDeveloping.Country     79.396
Schooling:StatusDeveloping.Country               8.115
(Intercept):Adult.Country                      974.507
StatusDeveloping:Adult.Country                 962.323
Adult:Adult.Country                           1000.000
BMI:Adult.Country                             1000.000
Diphtheria:Adult.Country                      1000.000
HIV:Adult.Country                             1000.000
Income_composition:Adult.Country              1159.840
Schooling:Adult.Country                       1195.817
(Intercept):BMI.Country                        852.818
StatusDeveloping:BMI.Country                   455.251
Adult:BMI.Country                             1000.000
BMI:BMI.Country                               1000.000
Diphtheria:BMI.Country                        1082.814
HIV:BMI.Country                                897.282
Income_composition:BMI.Country                1000.000
Schooling:BMI.Country                         1000.000
(Intercept):Diphtheria.Country                 660.437
StatusDeveloping:Diphtheria.Country            487.053
Adult:Diphtheria.Country                      1000.000
BMI:Diphtheria.Country                        1082.814
Diphtheria:Diphtheria.Country                 1000.000
HIV:Diphtheria.Country                        1000.000
Income_composition:Diphtheria.Country          854.652
Schooling:Diphtheria.Country                  1000.000
(Intercept):HIV.Country                        280.052
StatusDeveloping:HIV.Country                    17.772
Adult:HIV.Country                             1000.000
BMI:HIV.Country                                897.282
Diphtheria:HIV.Country                        1000.000
HIV:HIV.Country                                517.733
Income_composition:HIV.Country                 161.299
Schooling:HIV.Country                          488.275
(Intercept):Income_composition.Country          54.480
StatusDeveloping:Income_composition.Country     79.396
Adult:Income_composition.Country              1159.840
BMI:Income_composition.Country                1000.000
Diphtheria:Income_composition.Country          854.652
HIV:Income_composition.Country                 161.299
Income_composition:Income_composition.Country  130.462
Schooling:Income_composition.Country            65.228
(Intercept):Schooling.Country                   38.710
StatusDeveloping:Schooling.Country               8.115
Adult:Schooling.Country                       1195.817
BMI:Schooling.Country                         1000.000
Diphtheria:Schooling.Country                  1000.000
HIV:Schooling.Country                          488.275
Income_composition:Schooling.Country            65.228
Schooling:Schooling.Country                    238.061

 R-structure:  ~units

      post.mean l-95% CI u-95% CI eff.samp
units     2.641    2.487    2.808     1000

 Location effects: Life.expectancy ~ Adult + BMI + Diphtheria + HIV + Income_composition + Schooling + Status + Year 

                   post.mean  l-95% CI  u-95% CI eff.samp  pMCMC    
(Intercept)        -2.118363 -6.302389  2.325936   1231.8  0.350    
Adult              -0.003135 -0.032696  0.025818   1000.0  0.846    
BMI                 0.012834 -0.023514  0.046510   1000.0  0.484    
Diphtheria          0.030048 -0.003444  0.066144   1000.0  0.086 .  
HIV                -1.017999 -1.364160 -0.654344    801.5 &lt;0.001 ***
Income_composition  2.496561  0.978591  3.779569    185.2 &lt;0.001 ***
Schooling           0.895499  0.694260  1.111216   1000.0 &lt;0.001 ***
StatusDeveloping   -1.738613 -5.561903  1.549475   1000.0  0.386    
Year                0.029464  0.026019  0.032313   1000.0 &lt;0.001 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="nlme-not-glmmadaptiveas-too-complex-random-structure" class="level4">
<h4 class="anchored" data-anchor-id="nlme-not-glmmadaptiveas-too-complex-random-structure">nlme (Not GLMMadaptive,as too complex random structure)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>model_nlmemax <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">lme</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> Life.expectancy <span class="sc">~</span> Adult <span class="sc">+</span> BMI <span class="sc">+</span> Diphtheria <span class="sc">+</span> HIV <span class="sc">+</span>Income_composition <span class="sc">+</span> Schooling <span class="sc">+</span> Status <span class="sc">+</span> Year,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Status <span class="sc">+</span> Adult <span class="sc">+</span> BMI <span class="sc">+</span> Diphtheria <span class="sc">+</span> HIV <span class="sc">+</span> Income_composition <span class="sc">+</span> Schooling<span class="sc">|</span>Country,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_new,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"REML"</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_nlmemax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-strategies" class="level3">
<h3 class="anchored" data-anchor-id="model-strategies">model strategies</h3>
<section id="simplify-random-effects" class="level4">
<h4 class="anchored" data-anchor-id="simplify-random-effects">Simplify random effects</h4>
<p>We fixed the model with the three packages and identified a convergence problem with the lme4/nlme package. First, we will simplify the random structure to resolve this issue.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_singularity</span>(model_lmemax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>lme4<span class="sc">::</span><span class="fu">VarCorr</span>(model_lmemax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Groups   Name               Std.Dev.  Corr                              
 Country  (Intercept)        8.8496236                                   
          StatusDeveloping   4.7822435  0.446                            
          Adult              0.0060001 -0.031 -0.115                     
          BMI                0.0162764  0.462 -0.039  0.725              
          Diphtheria         0.0065198 -0.170 -0.097 -0.398  0.041       
          HIV                0.5070424 -0.205  0.081  0.260 -0.363 -0.906
          Income_composition 6.0926584 -0.051 -0.389 -0.741 -0.339  0.620
          Schooling          0.6742043 -0.925 -0.205  0.244 -0.285  0.115
 Residual                    1.6038487                                   
              
              
              
              
              
              
              
 -0.574       
  0.238 -0.271
              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">## lower varaince with the Adult and Diphtheria</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>model_lme1<span class="ot">&lt;-</span>lme4<span class="sc">::</span><span class="fu">lmer</span>(Life.expectancy<span class="sc">~</span>Year<span class="sc">+</span>Status<span class="sc">+</span>Adult<span class="sc">+</span>BMI<span class="sc">+</span>Diphtheria<span class="sc">+</span>HIV<span class="sc">+</span>Income_composition<span class="sc">+</span>Schooling<span class="sc">+</span>(<span class="dv">1</span><span class="sc">+</span>Status<span class="sc">+</span>BMI<span class="sc">+</span>HIV<span class="sc">+</span>Income_composition<span class="sc">+</span>Schooling<span class="sc">|</span>Country),<span class="at">data =</span> data_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :
Model failed to converge with max|grad| = 0.164101 (tol = 0.002, component 1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, : Model is nearly unidentifiable: large eigenvalue ratio
 - Rescale variables?</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>lme4<span class="sc">::</span><span class="fu">VarCorr</span>(model_lme1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Groups   Name               Std.Dev.  Corr                              
 Country  (Intercept)        11.491414                                   
          StatusDeveloping    4.522161  0.083                            
          BMI                 0.011497  0.688 -0.078                     
          HIV                 0.604032  0.023 -0.021 -0.550              
          Income_composition  3.079165 -0.632 -0.512  0.009 -0.623       
          Schooling           0.655661 -0.963  0.041 -0.742 -0.090  0.577
 Residual                     1.684560                                   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## lower varaince with BMI</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>model_lme2<span class="ot">&lt;-</span>lme4<span class="sc">::</span><span class="fu">lmer</span>(Life.expectancy<span class="sc">~</span>Year<span class="sc">+</span>Status<span class="sc">+</span>Adult<span class="sc">+</span>BMI<span class="sc">+</span>Diphtheria<span class="sc">+</span>HIV<span class="sc">+</span>Income_composition<span class="sc">+</span>Schooling<span class="sc">+</span>(<span class="dv">1</span><span class="sc">+</span>Status<span class="sc">+</span>HIV<span class="sc">+</span>Income_composition<span class="sc">+</span>Schooling<span class="sc">|</span>Country),<span class="at">data =</span> data_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :
Model failed to converge with max|grad| = 0.0541099 (tol = 0.002, component 1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_singularity</span>(model_lme2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>lme4<span class="sc">::</span><span class="fu">VarCorr</span>(model_lme2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Groups   Name               Std.Dev. Corr                       
 Country  (Intercept)        11.86288                            
          StatusDeveloping    4.08564  0.034                     
          HIV                 0.64341  0.038  0.141              
          Income_composition  3.08808 -0.660 -0.514 -0.656       
          Schooling           0.63332 -0.970  0.139 -0.183  0.654
 Residual                     1.69108                            </code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">## lower varaince with schooling</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>model_lme3<span class="ot">&lt;-</span>lme4<span class="sc">::</span><span class="fu">lmer</span>(Life.expectancy<span class="sc">~</span>Year<span class="sc">+</span>Status<span class="sc">+</span>Adult<span class="sc">+</span>BMI<span class="sc">+</span>Diphtheria<span class="sc">+</span>HIV<span class="sc">+</span>Income_composition<span class="sc">+</span>Schooling<span class="sc">+</span>(<span class="dv">1</span><span class="sc">+</span>Status<span class="sc">+</span>HIV<span class="sc">+</span>Income_composition<span class="sc">|</span>Country),<span class="at">data =</span> data_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :
Model failed to converge with max|grad| = 0.00270332 (tol = 0.002, component 1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_singularity</span>(model_lme3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostic plot</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>output<span class="ot">&lt;-</span>DHARMa<span class="sc">::</span><span class="fu">simulateResiduals</span>(model_lme3)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I have resolved the issues and created a diagnostic plot (which is not ideal). However, we have alternative strategies to address these problems, such as increasing the maximum number of iterations. Furthermore, we can effectively utilize the Bayesian approach with MCMCglmm without initially excluding any random effects. #### Bayesian optimization</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="fu">list</span>(<span class="at">V=</span><span class="dv">1</span>, <span class="at">nu=</span><span class="fl">0.002</span>),        </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="fu">list</span>(<span class="at">G1=</span><span class="fu">list</span>(<span class="at">V=</span><span class="fu">diag</span>(<span class="dv">8</span>),<span class="at">nu=</span><span class="dv">8</span>)), </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">9</span>), <span class="at">V =</span> <span class="fu">diag</span>(<span class="dv">9</span>) <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>model_mcmc1<span class="ot">&lt;-</span>MCMCglmm<span class="sc">::</span><span class="fu">MCMCglmm</span>(Life.expectancy<span class="sc">~</span>Adult<span class="sc">+</span>BMI<span class="sc">+</span>Diphtheria<span class="sc">+</span>HIV<span class="sc">+</span> Income_composition<span class="sc">+</span>Schooling<span class="sc">+</span>Status<span class="sc">+</span> Year,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="at">random=</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span><span class="sc">+</span>Status<span class="sc">+</span>Adult<span class="sc">+</span>BMI<span class="sc">+</span> Diphtheria<span class="sc">+</span>HIV<span class="sc">+</span>Income_composition<span class="sc">+</span>Schooling)<span class="sc">:</span>Country,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span> data_new,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">family=</span> <span class="st">"gaussian"</span>,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior=</span> priors,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">nitt =</span> <span class="dv">13000</span>,</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">burnin =</span> <span class="dv">3000</span>,</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">10</span>,</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">pr =</span> <span class="cn">TRUE</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                       MCMC iteration = 0

                       MCMC iteration = 1000

                       MCMC iteration = 2000

                       MCMC iteration = 3000

                       MCMC iteration = 4000

                       MCMC iteration = 5000

                       MCMC iteration = 6000

                       MCMC iteration = 7000

                       MCMC iteration = 8000

                       MCMC iteration = 9000

                       MCMC iteration = 10000

                       MCMC iteration = 11000

                       MCMC iteration = 12000

                       MCMC iteration = 13000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_areas</span>(<span class="fu">as.matrix</span>(model_mcmc1<span class="sc">$</span>Sol), <span class="at">prob =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude the "Adult","BMI" and "Diphtheria"</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="fu">list</span>(<span class="at">V=</span><span class="dv">1</span>, <span class="at">nu=</span><span class="fl">0.002</span>),        </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="fu">list</span>(<span class="at">G1=</span><span class="fu">list</span>(<span class="at">V=</span><span class="fu">diag</span>(<span class="dv">5</span>),<span class="at">nu=</span><span class="dv">5</span>)), </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">9</span>), <span class="at">V =</span> <span class="fu">diag</span>(<span class="dv">9</span>) <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>model_mcmc2<span class="ot">&lt;-</span>MCMCglmm<span class="sc">::</span><span class="fu">MCMCglmm</span>(Life.expectancy<span class="sc">~</span>Adult<span class="sc">+</span>BMI<span class="sc">+</span>Diphtheria<span class="sc">+</span>HIV<span class="sc">+</span> Income_composition<span class="sc">+</span>Schooling<span class="sc">+</span>Status<span class="sc">+</span> Year,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="at">random=</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span><span class="sc">+</span>Status<span class="sc">+</span>HIV<span class="sc">+</span>Income_composition<span class="sc">+</span>Schooling)<span class="sc">:</span>Country,</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span> data_new,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">family=</span> <span class="st">"gaussian"</span>,</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior=</span> priors,</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">nitt =</span> <span class="dv">13000</span>,</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">burnin =</span> <span class="dv">3000</span>,</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">10</span>,</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">pr =</span> <span class="cn">TRUE</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                       MCMC iteration = 0

                       MCMC iteration = 1000

                       MCMC iteration = 2000

                       MCMC iteration = 3000

                       MCMC iteration = 4000

                       MCMC iteration = 5000

                       MCMC iteration = 6000

                       MCMC iteration = 7000

                       MCMC iteration = 8000

                       MCMC iteration = 9000

                       MCMC iteration = 10000

                       MCMC iteration = 11000

                       MCMC iteration = 12000

                       MCMC iteration = 13000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_areas</span>(<span class="fu">as.matrix</span>(model_mcmc2<span class="sc">$</span>Sol), <span class="at">prob =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>posterior_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_mcmc2, <span class="at">marginal =</span> <span class="cn">NULL</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> data_new<span class="sc">$</span>Life.expectancy<span class="sc">-</span>posterior_pred</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuals, <span class="at">main =</span> <span class="st">"Residuals plot"</span>, <span class="at">xlab =</span> <span class="st">"Fitted Values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>residuals_standardized <span class="ot">&lt;-</span> residuals <span class="sc">/</span> <span class="fu">sd</span>(residuals)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(residuals_standardized, <span class="at">main =</span> <span class="st">"QQ Plot1 of Standardized Residuals"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(residuals_standardized, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-10-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Comparing the two models, the one with Bayesian optimization yields better results; however, the QQ plot indicates a poor fit. Consider transforming the response variable using the log of the Gamma distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Response variable transformation</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>data_new<span class="sc">$</span>log_life<span class="ot">&lt;-</span><span class="fu">log</span>(data_new<span class="sc">$</span>Life.expectancy)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="fu">list</span>(<span class="at">V=</span><span class="dv">1</span>, <span class="at">nu=</span><span class="fl">0.002</span>),        </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="fu">list</span>(<span class="at">G1=</span><span class="fu">list</span>(<span class="at">V=</span><span class="fu">diag</span>(<span class="dv">5</span>),<span class="at">nu=</span><span class="dv">5</span>)), </span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">9</span>), <span class="at">V =</span> <span class="fu">diag</span>(<span class="dv">9</span>) <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>model_mcmc3<span class="ot">&lt;-</span>MCMCglmm<span class="sc">::</span><span class="fu">MCMCglmm</span>(log_life<span class="sc">~</span>Adult<span class="sc">+</span>BMI<span class="sc">+</span>Diphtheria<span class="sc">+</span>HIV<span class="sc">+</span> Income_composition<span class="sc">+</span>Schooling<span class="sc">+</span>Status<span class="sc">+</span> Year,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="at">random=</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span><span class="sc">+</span>Status<span class="sc">+</span>HIV<span class="sc">+</span>Income_composition<span class="sc">+</span>Schooling)<span class="sc">:</span>Country,</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span> data_new,</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">family=</span> <span class="st">"gaussian"</span>,</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior=</span> priors,</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">nitt =</span> <span class="dv">13000</span>,</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">burnin =</span> <span class="dv">3000</span>,</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">10</span>,</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">pr =</span> <span class="cn">TRUE</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                       MCMC iteration = 0

                       MCMC iteration = 1000

                       MCMC iteration = 2000

                       MCMC iteration = 3000

                       MCMC iteration = 4000

                       MCMC iteration = 5000

                       MCMC iteration = 6000

                       MCMC iteration = 7000

                       MCMC iteration = 8000

                       MCMC iteration = 9000

                       MCMC iteration = 10000

                       MCMC iteration = 11000

                       MCMC iteration = 12000

                       MCMC iteration = 13000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_areas</span>(<span class="fu">as.matrix</span>(model_mcmc3<span class="sc">$</span>Sol), <span class="at">prob =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>posterior_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_mcmc3, <span class="at">marginal =</span> <span class="cn">NULL</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> data_new<span class="sc">$</span>log_life<span class="sc">-</span>posterior_pred</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuals, <span class="at">main =</span> <span class="st">"Residuals plot_log Transformation"</span>, <span class="at">xlab =</span> <span class="st">"Fitted Values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>residuals_standardized <span class="ot">&lt;-</span> residuals <span class="sc">/</span> <span class="fu">sd</span>(residuals)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(residuals_standardized, <span class="at">main =</span> <span class="st">"QQ Plot2 of Standardized Residuals"</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(residuals_standardized, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It yields better results with the residual plot and the QQ plot. Further adjustments may be needed, but I am unsure how to make them.</p>
</section>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In conclusion, we selected eight effective predictors, incorporating random slope effects for Status, HIV, Income Composition, and Schooling, grouped by country. Among these, the status related to the level of development has a significant impact, while Income Composition has a positive influence. Additionally, Schooling and HIV each have distinct effects on life expectancy, with one positively and the other negatively influencing it.</p>
<section id="fixed-effect-coefficient-plots-not-very-clear" class="level3">
<h3 class="anchored" data-anchor-id="fixed-effect-coefficient-plots-not-very-clear">fixed effect coefficient plots( not very clear)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>posterior_s<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(model_mcmc3<span class="sc">$</span>Sol)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>posterior_summary<span class="ot">&lt;-</span>posterior_s<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),<span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span> <span class="fu">mean</span>(.),<span class="at">lower =</span> <span class="sc">~</span> <span class="fu">quantile</span>(., <span class="fl">0.025</span>),<span class="at">upper =</span> <span class="sc">~</span> <span class="fu">quantile</span>(., <span class="fl">0.975</span>))))<span class="sc">|&gt;</span>tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="at">names_to =</span><span class="fu">c</span>(<span class="st">"Parameter"</span>, <span class="st">".value"</span>),<span class="at">names_sep =</span> <span class="st">"_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 2 pieces. Additional pieces discarded in 582 rows [16, 17, 18, 1765,
1766, 1767, 1768, 1769, 1770, 1771, 1772, 1773, 1774, 1775, 1776, 1777, 1778,
1779, 1780, 1781, ...].</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>posterior_summary<span class="sc">$</span>Parameter <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Country"</span>, <span class="st">"C"</span>, posterior_summary<span class="sc">$</span>Parameter)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>posterior_summary<span class="sc">$</span>Parameter <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Intercept"</span>, <span class="st">"(Int)"</span>, posterior_summary<span class="sc">$</span>Parameter)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>posterior_summary<span class="sc">|&gt;</span>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Parameter, mean), <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Coefficient Plot"</span>, <span class="at">x =</span> <span class="st">"Parameters"</span>, <span class="at">y =</span> <span class="st">"Posterior Mean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Now keep 25 random varaibles to plot, with less mess</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>summary_new<span class="ot">&lt;-</span> posterior_summary <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(mean))) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>summary_new<span class="sc">|&gt;</span>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Parameter, mean), <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Coefficient Plot with top 25"</span>, <span class="at">x =</span> <span class="st">"Parameters"</span>, <span class="at">y =</span> <span class="st">"Posterior Mean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="random-effects-plot" class="level3">
<h3 class="anchored" data-anchor-id="random-effects-plot">random effects plot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>random_effects<span class="ot">&lt;-</span> model_mcmc3<span class="sc">$</span>VCV</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>summary_r <span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(random_effects)<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">summarise_all</span>(<span class="fu">list</span>(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="sc">~</span> <span class="fu">mean</span>(.),</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="sc">~</span> <span class="fu">quantile</span>(., <span class="fl">0.025</span>),</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="sc">~</span> <span class="fu">quantile</span>(., <span class="fl">0.975</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  ))<span class="sc">|&gt;</span>tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"Effect"</span>, <span class="st">".value"</span>), <span class="at">names_sep =</span> <span class="st">"_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 2 pieces. Additional pieces discarded in 27 rows [4, 9, 14, 16, 17,
18, 19, 20, 24, 30, 35, 40, 42, 43, 44, 45, 46, 50, 56, 61, ...].</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>summary_r<span class="sc">|&gt;</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> <span class="fu">reorder</span>(Effect, mean), <span class="at">y=</span> mean)) <span class="sc">+</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Posterior Random Effects for Countries"</span>,</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Random Effect by Country"</span>,</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Posterior Mean with 95% CI"</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 15 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_projectSTAT720_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>